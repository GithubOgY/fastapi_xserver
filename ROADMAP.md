# プロジェクト履歴とロードマップ

---

## 🚀 開発ガイドライン（新規アプリ作成時のTODO順序）

新しいアプリを作成する際は、以下の順序で開発を進めること：

### 1. ランディングページ（トップページ）の作成 ⭐ 最優先
- アプリの概要・特徴を説明するページ
- ログイン / 新規登録ボタンを配置
- 未ログインユーザーが最初に見るページ

### 2. 認証システムの構築
- ユーザー登録ページ (`/register`)
- ログインページ (`/login`)
- 登録完了ページ（お礼メッセージ）
- ログアウト機能

### 3. メインダッシュボード
- ログイン後のメイン画面
- 主要機能へのアクセス

### 4. 管理機能
- 管理者用ユーザー管理画面
- アカウント設定ページ（ユーザー自身の情報管理・削除）

### 5. データ・API連携
- データベース設計・接続
- 外部API連携
- **EDINET API**: 日本企業の公式財務データ取得に使用（詳細は `EDINET_API_GUIDE.md` 参照）

### 6. UI/UX改善・最終調整
- エラーメッセージのUI整備
- レスポンシブ対応
- パフォーマンス最適化

---

## 完了済みのタスク (Done)
- [x] プロジェクト初期構造の作成 (FastAPI + htmx)
- [x] ローカル開発環境の構築 (`start_dev.bat`)
- [x] Docker + Docker Compose によるコンテナ化
- [x] Nginx によるリバースプロキシ設定
- [x] GitHub リポジトリ (`GithubOgY/fastapi_xserver`) へのプッシュ
- [x] Xserver VPS へのデプロイ
- [x] `certbot` による SSL 証明書の取得と HTTPS 化
- [x] HEAD メソッドの許可による 405 エラーの解消
- [x] ランディングページの作成
- [x] ユーザー登録・ログイン・ログアウト機能
- [x] 管理者画面（ユーザー管理）
- [x] アカウント設定・削除機能

## 実装済みの機能
- **ランディングページ**: アプリの説明、使い方、CTAボタン
- **認証システム**: ログイン/ログアウト/新規登録/登録完了ページ
- **ダッシュボード**: 株価財務データの可視化
- **カウンター機能**: htmx を使用したページ遷移なしのインクリメント
- **メッセージエコー**: フォーム入力内容をサーバー経由でリアルタイム反映
- **グラスモーフィズムUI**: モダンでプレミアムなデザイン
- **ユーザー管理**: 管理者画面でのユーザー一覧・削除
- **アカウント管理**: ユーザー自身によるアカウント削除

## 今後のTODO / ロードマップ (Todo)
- [x] **データベース接続**: PostgreSQL や SQLite を導入してデータを永続化する。
- [x] **ユーザー認証**: ログイン機能の実装。
- [x] **自動デプロイ (CI/CD)**: GitHub Actions を使って push 時に自動で VPS を更新する。
- [x] **ロギングの強化**: アプリのログをファイルに保存し、分析可能にする。
- [x] **ドメインの追加**: (今回は追加不要のため完了)

---

## 次のフェーズ (Next Phase: 機能拡張)
### 1. データの拡充と動的管理
- [x] **複数銘柄への対応**: トヨタ以外の銘柄も追加・検索できる機能。
- [x] **データ管理機能 (CRUD)**: ブラウザから財務データを追加・編集・削除できるフォーム。（動作確認済み、現在は外部API連携に統合）
- [x] **外部API連携**: `yfinance` を使い、最新の財務データを自動取得。

### 2. ビジュアライゼーション (可視化)
- [x] **業績グラフ表示**: `Chart.js` を導入し、利益推移をグラフ化。
- [x] **投資指標の自動計算**: (売上・利益の推移を表示。指標計算は今後の拡張)

### 3. システムの安定化
- [x] **環境変数の管理**: `.env` ファイルによる SECRET_KEY などの秘匿化。
- [x] **DBアップグレード**: データ増加に備えた PostgreSQL への移行。
- [x] **ユーザー登録機能**: 新規アカウント作成機能の追加。

---

## 🆕 今後の発展 TODO（未着手）

### Phase 4: ユーザー体験の向上
- [x] **ダークモード/ライトモード切替**: ユーザーの好みに応じたテーマ切替機能
- [x] **お気に入り銘柄機能**: ユーザーごとにウォッチリストを作成・管理
- [x] **銘柄比較機能**: 複数銘柄を並べて比較表示
- [x] **検索・フィルター機能**: 銘柄コードや企業名で検索
- [x] **通知機能**: メール通知の基本機能実装完了（APIエンドポイント `/api/test-email` で動作確認済み）

### Phase 5: データ分析機能の強化
- [x] **EDINET API統合**: 公式財務データ（有価証券報告書）の自動取得・解析機能を実装
  - 詳細: `EDINET_API_GUIDE.md` 参照
  - 実装ファイル: `utils/edinet_api.py`, `utils/edinet_enhanced.py`
  - APIエンドポイント: `/api/edinet/search`, `/api/edinet/history/{code}`
  - ダッシュボードUIに統合済み
- [x] **投資指標の計算**: PER, PBR, ROE, 配当利回りなどの自動計算・表示（EDINETデータより抽出）
- [x] **年度比較グラフ**: 前年比成長率の可視化
- [ ] **セクター別分析**: 業種ごとの平均との比較
- [x] **AIによる業績分析 (v2)**: Gemini 2.0 FlashをEDINETページに完全統合
    - ダッシュボードから「詳細財務分析」への導線を確立
    - 自動検索機能 (`api_edinet_search`) の不具合修正と機能強化
    - 財務健全性、事業競争力、リスク分析の3つの視点での詳細分析実装
    - AI生成コンテンツに関する免責事項ページ（`https://site.y-project-vps.xyz/ai-policy`）の作成
- [x] **定性情報のUX改善**: グリッドレイアウト、不要な改行の削除、誤解を招く財務数値の非表示化
- [x] **ニュース連携**: Google News RSSを活用したニュース自動取得
- [ ] **EDINETデータ蓄積**: 日次の新着書類を自動巡回・DB保存する基盤構築

### Phase 6: ソーシャル機能
- [x] **コメント・メモ機能**: 銘柄ごとにユーザーがメモを残せる（掲示板・Discussion Boardとして実装）
- [x] **共有機能**: 分析結果をSNSやURLで共有
- [x] **ユーザープロフィール**: 公開プロフィールページ
- [x] **フォロー機能**: 他のユーザーの分析をフォロー

### Phase 7: モバイル対応・アプリ化
- [x] **PWA対応**: Progressive Web Appとしてスマホにインストール可能に（2024/12/29完了）
  - マニフェストファイル、サービスワーカーの実装
  - オフラインページ (`offline.html`) の作成
- [x] **レスポンシブ強化**: タブレット・スマホでの表示最適化（2024/12/29完了）
- [ ] **プッシュ通知**: 株価アラートなどのプッシュ通知

### Phase 8: 収益化・プレミアム機能
- [ ] **プレミアムプラン**: 有料会員向けの高度な機能
- [ ] **API提供**: 外部サービス向けのAPI公開
- [ ] **広告表示**: 無料ユーザー向けの広告表示
- [ ] **決済連携**: Stripe等による課金システム

### Phase 9: インフラ・セキュリティ
- [ ] **2段階認証 (2FA)**: セキュリティ強化
- [ ] **レート制限**: API乱用防止のためのレートリミット
- [ ] **監査ログ**: 管理者操作の記録
- [x] **バックアップ自動化**: DB定期バックアップ（2026/01/02完了）
  - 自動バックアップスクリプト (`scripts/backup.sh`)
  - リストアスクリプト (`scripts/restore.sh`)
  - cron設定で毎日午前3時に自動実行
  - SHA256チェックサムによる整合性確認
  - 30日以上古いバックアップの自動削除
- [ ] **負荷分散**: 複数サーバーでのスケールアウト

---

## 💡 アイデアメモ（検討中）
- スクリーニング機能（条件に合う銘柄を自動抽出）
- ポートフォリオ管理（保有株の記録と損益計算）
- チャート分析ツール（ローソク足、移動平均線）
- 決算カレンダー連携
- 海外株式への対応（米国株など）

---

## 📌 次回セッション TODO（2025/12/28予定）

### EDINET データ拡充作業

#### 1. 財務データの5年間推移表示
取得対象データ：
- **売上高**（成長率10%〜30%の適正範囲チェック）
- **営業利益・経常利益・純利益**
- **EPS（1株当たり利益）**
- **営業キャッシュフロー** ← 最重要（利益の質チェック）
- **投資キャッシュフロー・財務キャッシュフロー**
- **ネットキャッシュ**（現金 − 有利子負債）
- **純資産・総資産**（PBR計算用）
- **ROE・ROA・自己資本比率**
- **配当金・配当利回り**

#### 2. 企業の計画・報告の取得
- **中期経営計画**（doc_type調査必要）
- **決算短信**（四半期ごとの速報）
- **有価証券報告書の記述情報**（事業リスク、経営方針など）

#### 3. 投資判断支援機能
目標：5段階プロトコルに基づく自動スクリーニング
- Step 1: 売上成長率フィルタ（10%〜30%）
- Step 2: PER/マルチプル分析
- Step 3: 営業CF > 純利益 のクオリティチェック
- Step 4: インデックス比較（ROE > 10%）
- Step 5: エグジット条件の設定

#### 参考：投資手法（片山晃・田端信太郎・たーちゃんハイブリッド）
- 詳細はCursorチャット履歴を参照
- 「利益は意見、キャッシュは事実」を重視
